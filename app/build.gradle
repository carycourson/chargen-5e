/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details on building Java & JVM projects, please refer to https://docs.gradle.org/8.8/userguide/building_java_projects.html in the Gradle documentation.
 */
import com.github.spotbugs.snom.SpotBugsTask
import com.github.spotbugs.snom.Effort
import com.github.spotbugs.snom.Confidence
import com.github.spotbugs.snom.SpotBugsExtension

plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'
    id 'org.openjfx.javafxplugin' version '0.1.0'
    id "com.adarshr.test-logger" version "4.0.0"
    id 'checkstyle'
    id 'com.github.spotbugs' version '6.0.4'
}

repositories {
    // Use Maven Central for resolving dependencies.
    mavenCentral()
}

dependencies {
    // --- MAIN DEPENDENCIES ---
    implementation 'com.google.guava:guava:33.2.0-jre'

    // --- TEST DEPENDENCIES ---
    testImplementation 'org.junit.jupiter:junit-jupiter:5.10.2'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'

    // Lombok
    compileOnly 'org.projectlombok:lombok:1.18.32'
    annotationProcessor 'org.projectlombok:lombok:1.18.32'
    testCompileOnly 'org.projectlombok:lombok:1.18.32'
    testAnnotationProcessor 'org.projectlombok:lombok:1.18.32'

    // Jackson
    implementation 'com.fasterxml.jackson.core:jackson-databind:2.15.2'
    implementation 'com.fasterxml.jackson.core:jackson-annotations:2.15.2'
    implementation 'com.fasterxml.jackson.core:jackson-core:2.15.2'

    // Guice
        // Core Guice DI container
    implementation 'com.google.inject:guice:5.1.0'
    // If you use any JSR-330 javax.inject annotations
    implementation 'javax.inject:javax.inject:1'

    // SpotBugs
    spotbugsPlugins 'com.h3xstream.findsecbugs:findsecbugs-plugin:1.12.0' // Example of a SpotBugs plugin
    compileOnly 'com.github.spotbugs:spotbugs-annotations:4.8.3' // Or implementation

}

// Apply a specific Java toolchain to ease working on different environments.
java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

javafx {
    version = "21"
    modules = [ 'javafx.controls', 'javafx.fxml' ]
}

application {
    // Define the main class for the application.
    mainClass = 'chargen.cli.MainApp'
}

tasks.named('test') {
    // Use JUnit Platform for unit tests.
    useJUnitPlatform()
}

tasks.withType(Checkstyle).configureEach {
    // fail build on violations
    ignoreFailures = false
    reports {
        xml.required = false
        html.required = true
        html.outputLocation = file("$buildDir/reports/checkstyle/checkstyle.html")
    }
}

tasks.withType(SpotBugsTask).configureEach {
    ignoreFailures = false
    reports {
        xml.enabled = false
        html.enabled = true
        html.destination = file("$buildDir/reports/spotbugs/spotbugs.html")
    }
}

testlogger {
    theme 'standard'
    showExceptions true
    showStackTraces true
    showFullStackTraces false
    showCauses true
    slowThreshold 2000
    showSummary true
    showSimpleNames false
    showPassed true
    showSkipped true
    showFailed true
    showOnlySlow false
    showStandardStreams false
    showPassedStandardStreams true
    showSkippedStandardStreams true
    showFailedStandardStreams true
    logLevel 'lifecycle'
}

checkstyle {
    toolVersion = "10.12.1"                      // pick the latest
    configDirectory = file("$rootDir/config/checkstyle")
    // you can also point to a single file:
    // configFile = file("$rootDir/config/checkstyle/checkstyle.xml")
}

// Configure the SpotBugs extension
spotbugs {
    effort = Effort.MAX          // This seemed to work before the 'reportLevel' issue
    // confidence = Confidence.LOW  // *** TRY THIS INSTEAD OF reportLevel ***
    excludeFilter = file("$rootDir/config/spotbugs/exclude.xml")
    // toolVersion = '4.8.3' // Optional
}

// Make sure SpotBugs runs, e.g., as part of 'check'
tasks.named('check') {
    dependsOn spotbugsMain, spotbugsTest // If you want to run it on test code too
}
